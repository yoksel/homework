function addVideoToCanvasWebGL(a){function b(){if(f.clear(f.COLOR_BUFFER_BIT),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,m),d)try{f.texImage2D(f.TEXTURE_2D,0,f.RGB,f.RGB,f.UNSIGNED_BYTE,c)}catch(a){n++,10>n?console.log(a):10==n&&console.log("...")}f.bindBuffer(f.ARRAY_BUFFER,k),f.vertexAttribPointer(j,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0),window.requestAnimationFrame(b)}var c=document.querySelector(".video"),d=!1;c.autoplay=!0,c.loop=!0,c.oncanplay=function(){d=!0},c.onerror=function(){var a="unknown error";switch(c.error.code){case 1:a="video loading aborted";break;case 2:a="network loading error";break;case 3:a="video decoding failed / corrupted data or unsupported codec";break;case 4:a="video not supported";}console.log("Error: "+a+" (errorcode="+c.error.code+")")},c.srcObject=a,c.play();var e=document.getElementById("video-canvas"),f=e.getContext("webgl");f||console.log("No WebGL support"),f.enable(f.BLEND),f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA);var g=f.createShader(f.VERTEX_SHADER);f.shaderSource(g,"attribute vec2 vx;varying vec2 tx;void main(){gl_Position=vec4(vx.x*2.0-1.0,1.0-vx.y*2.0,0,1);tx=vx;}"),f.compileShader(g);var h=f.createShader(f.FRAGMENT_SHADER);f.shaderSource(h,"precision mediump float;uniform sampler2D sm;varying vec2 tx;void main(){gl_FragColor=texture2D(sm,tx);}"),f.compileShader(h);var i=f.createProgram();f.attachShader(i,g),f.attachShader(i,h),f.linkProgram(i),f.useProgram(i);var j=f.getAttribLocation(i,"vx");f.enableVertexAttribArray(j),f.uniform1i(f.getUniformLocation(i,"sm"),0);var k=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,k),f.bufferData(f.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),f.STATIC_DRAW);var l=f.createBuffer();f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l),f.bufferData(f.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),f.STATIC_DRAW);var m=f.createTexture();f.bindTexture(f.TEXTURE_2D,m),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR);var n=0;b()}"use strict",function(){function a(a){function b(a,c){a.paused||a.ended||(c.drawImage(a,0,0),requestAnimationFrame(function(){b(a,c)}))}var c=document.querySelector("#video-canvas"),d=c.getContext("2d",{alpha:!1});a.addEventListener("loadedmetadata",function(){c.width=a.videoWidth,c.height=a.videoHeight}),a.addEventListener("play",function(){b(a,d)},0)}function b(a){function b(a,h){if(!a.paused&&!a.ended){h.drawImage(a,0,0,g.clientWidth,g.clientHeight);var k=h.getImageData(0,0,g.width,g.height),l=k.data;if(d&&!j&&(f(l),j=!0),d){var m=c(d,l);!1===m?e.classList.add(i):e.classList.remove(i)}d=l,setTimeout(function(){requestAnimationFrame(function(){b(a,h)})},500)}}var d="",e=document.querySelector(".move-detection"),g=document.querySelector(".move-detection__detector"),h=g.getContext("2d",{alpha:!1}),i="move-detection--detected",j=!1;a.addEventListener("play",function(){e.classList.remove("move-detection--hidden"),b(a,h)},0)}function c(a,b){for(var c=!0,d=0;d<a.length;d+=500)if(Math.abs(a[d]-b[d])>15)return!1;return c}function d(a){var b,c=new(window.AudioContext||window.webkitAudioContext),d=c.createAnalyser();d.minDecibels=-90,d.maxDecibels=-10,d.smoothingTimeConstant=.85;var e=c.createWaveShaper(),f=c.createGain(),g=c.createBiquadFilter(),h=c.createConvolver(),i=document.querySelector(".audio-visualizer"),j=document.querySelector(".audio-visualizer__canvas"),k=j.getContext("2d");navigator.mediaDevices.getUserMedia?(b=c.createMediaStreamSource(a),b.connect(d),d.connect(e),e.connect(g),g.connect(h),h.connect(f),f.connect(c.destination),i.classList.remove("audio-visualizer--hidden"),function(){var a=j.width,b=j.height;d.fftSize=128;var c=d.frequencyBinCount,e=new Uint8Array(c);k.clearRect(0,0,a,b);var f=function(){drawVisual=requestAnimationFrame(f),d.getByteFrequencyData(e),k.fillStyle="hsl(0, 0, 0)",k.fillRect(0,0,a,b);for(var g,h=a/c,j=0,l=0;l<c;l++)g=e[l],k.fillStyle="hsl(0, 0%,"+g+"%)",k.fillRect(j,b-g/2,h,g/2),j+=h+3};f()}()):console.log("getUserMedia not supported on your browser")}function e(a){var b=4,c=25,d=120,e=d,f=document.querySelector(".data"),g=document.createElement("ul");g.classList.add("data__list"),a.addEventListener("play",function(){f.classList.remove("data--hidden")},0);for(var j,l=0;l<b;l++){j=document.createElement("li"),j.classList.add("data__item"),j.innerHTML="",g.appendChild(j);var m=0,p=3,q=[h(6*Math.random())+5,h(4*Math.random())+6],r=0,s=q[r],t=h(Math.random()*c/2)+c/2,u=q[0]+q[1]+2*p;t-p<=u&&(t=u-p);for(var i=0;i<t;i++){if(m>s&&m<=s+p)j.innerHTML+=e+"<br/>",m==s+p&&(r++,s=q[r],m=0);else{for(var k=[""+e,(50*e).toString(16)],n=h(2*Math.random())+1,o=0;o<n;o++)k.push((e-40+o).toString(16));j.innerHTML+=k.join("\t")+"<br>"}m++,e++}}f.appendChild(g)}function f(a){function b(){d.classList.toggle("analysis--hidden");var a=5e3*Math.random()+4e3;setTimeout(b,a)}var c=120,d=document.querySelector(".analysis"),e=document.querySelector(".analysis__content");d.classList.remove("analysis--hidden");var f=a.slice(0,200),g=[];f.forEach(function(a){8<=a&&255!==a&&g.push(a.toString(2).substr(0,4))}),e.innerHTML=g.join(" "),b()}function g(){function a(){if("up"===m)i<k?(i+=l,b(),!g&&(e.classList.add(f),g=!0)):(m="down",b(),g&&(e.classList.remove(f),g=!1));else if(0<i)i-=l,b();else{var d=h(3*Math.random())+2;c.setAttribute("scale",0),setTimeout(function(){a(),m="up"},1e3*d)}}function b(){var b=i;j=i/2.5,i%2&&(b=-b),c.setAttribute("scale",b),d.setAttribute("dx",-j),d.setAttribute("dy",-j),requestAnimationFrame(a)}var c=document.getElementById("feMap"),d=document.getElementById("feOffset"),e=document.querySelector(".content"),f="content--has-filter",g=!1,i=0,j=0,k=240,l=k/3,m="up";a()}var h=Math.round;(function(){navigator.mediaDevices.getUserMedia({audio:!0,video:{width:{min:320,ideal:800},height:{min:240,ideal:600}}}).then(function(c){var f=document.querySelector(".video"),h=document.querySelector(".content");f.srcObject=c;f.addEventListener("loadedmetadata",function(){f.play(),h.classList.add("content--video-playing"),g()}),d(c),a(f,c),b(f,c),e(f)}).catch(function(a){console.log("Error: ",a.name+": "+a.message)})})()}();
//# sourceMappingURL=common.js.map
