function addVideoToCanvasWebGL(a){function b(){if(f.clear(f.COLOR_BUFFER_BIT),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,m),d)try{f.texImage2D(f.TEXTURE_2D,0,f.RGB,f.RGB,f.UNSIGNED_BYTE,c)}catch(a){n++,10>n?console.log(a):10==n&&console.log('...')}f.bindBuffer(f.ARRAY_BUFFER,k),f.vertexAttribPointer(j,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0),window.requestAnimationFrame(b)}var c=document.querySelector('.video'),d=!1;c.autoplay=!0,c.loop=!0,c.oncanplay=function(){d=!0},c.onerror=function(){var a='unknown error';switch(c.error.code){case 1:a='video loading aborted';break;case 2:a='network loading error';break;case 3:a='video decoding failed / corrupted data or unsupported codec';break;case 4:a='video not supported';}console.log('Error: '+a+' (errorcode='+c.error.code+')')},c.srcObject=a,c.play();var e=document.getElementById('video-canvas'),f=e.getContext('webgl');f||console.log('No WebGL support'),f.enable(f.BLEND),f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA);var g=f.createShader(f.VERTEX_SHADER);f.shaderSource(g,'attribute vec2 vx;varying vec2 tx;void main(){gl_Position=vec4(vx.x*2.0-1.0,1.0-vx.y*2.0,0,1);tx=vx;}'),f.compileShader(g);var h=f.createShader(f.FRAGMENT_SHADER);f.shaderSource(h,'precision mediump float;uniform sampler2D sm;varying vec2 tx;void main(){gl_FragColor=texture2D(sm,tx);}'),f.compileShader(h);var i=f.createProgram();f.attachShader(i,g),f.attachShader(i,h),f.linkProgram(i),f.useProgram(i);var j=f.getAttribLocation(i,'vx');f.enableVertexAttribArray(j),f.uniform1i(f.getUniformLocation(i,'sm'),0);var k=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,k),f.bufferData(f.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),f.STATIC_DRAW);var l=f.createBuffer();f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l),f.bufferData(f.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),f.STATIC_DRAW);var m=f.createTexture();f.bindTexture(f.TEXTURE_2D,m),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR);var n=0;b()}'use strict',function(){function a(a){function c(a,h){if(!a.paused&&!a.ended){h.drawImage(a,0,0,g.clientWidth,g.clientHeight);var k=h.getImageData(0,0,g.width,g.height),l=k.data;if(d&&!j&&(f(l),j=!0),d){var m=b(d,l);!1===m?e.classList.add(i):e.classList.remove(i)}d=l,setTimeout(function(){requestAnimationFrame(function(){c(a,h)})},500)}}var d='',e=document.querySelector('.move-detection'),g=document.querySelector('.move-detection__detector'),h=g.getContext('2d',{alpha:!1}),i='move-detection--detected',j=!1;a.addEventListener('play',function(){e.classList.remove('move-detection--hidden'),c(a,h)},0)}function b(a,b){for(var c=!0,d=0;d<a.length;d+=500)if(Math.abs(a[d]-b[d])>15)return!1;return c}function c(a){var b,c=new(window.AudioContext||window.webkitAudioContext),e=c.createAnalyser();e.minDecibels=-90,e.maxDecibels=-10,e.smoothingTimeConstant=.85;var f=c.createWaveShaper(),g=c.createGain(),h=c.createBiquadFilter(),i=c.createConvolver(),j=document.querySelector('.audio-visualizer'),k=document.querySelector('.audio-visualizer__canvas'),l=k.getContext('2d');navigator.mediaDevices.getUserMedia?(b=c.createMediaStreamSource(a),b.connect(e),e.connect(f),f.connect(h),h.connect(i),i.connect(g),g.connect(c.destination),j.classList.remove('audio-visualizer--hidden'),function(){var a=k.width,b=k.height;e.fftSize=128;var c=e.frequencyBinCount,f=new Uint8Array(c);l.clearRect(0,0,a,b);var g=function(){d(f),e.getByteFrequencyData(f),l.fillStyle='hsl(0, 0%, 0%)',l.fillRect(0,0,a,b);for(var h,j=a/c,k=0,m=0;m<c;m++)h=f[m],l.fillStyle='hsla(0, 0%,'+h+'%, 1)',l.fillRect(k,b-h/2,j,h/2),k+=j+3;requestAnimationFrame(g)};g()}()):console.log('getUserMedia not supported on your browser')}function d(a){var b=document.querySelector('.audio-visualizer'),c='audio-visualizer--loud-warning',d=document.querySelector('.audio-visualizer__warning'),e=document.querySelector('.content'),f='content--loud-warning',g=a.slice(0,10),h=g.reduce(function(a,b){return a+b},0);500<h?(d.innerHTML='Too loud',e.classList.add(f),b.classList.add(c)):(d.innerHTML='Normal',e.classList.remove(f),b.classList.remove(c))}function e(a){var b=25,c=120,d=document.querySelector('.data'),e=document.createElement('ul');e.classList.add('data__list'),a.addEventListener('play',function(){d.classList.remove('data--hidden')},0);for(var f,g=0;g<4;g++){f=document.createElement('li'),f.classList.add('data__item'),f.innerHTML='',e.appendChild(f);var m=0,n=3,o=[h(6*Math.random())+5,h(4*Math.random())+6],p=0,q=o[p],r=h(Math.random()*b/2)+b/2,s=o[0]+o[1]+2*n;r-n<=s&&(r=s-n);for(var i=0;i<r;i++){if(m>q&&m<=q+n)f.innerHTML+=c+'<br/>',m==q+n&&(p++,q=o[p],m=0);else{for(var j=[''+c,(50*c).toString(16)],k=h(2*Math.random())+1,l=0;l<k;l++)j.push((c-40+l).toString(16));f.innerHTML+=j.join('\t')+'<br>'}m++,c++}}d.appendChild(e)}function f(a){function b(){c.classList.toggle('analysis--hidden');var a=3e3*Math.random()+4e3;setTimeout(b,a)}var c=document.querySelector('.analysis'),d=document.querySelector('.analysis__content');c.classList.remove('analysis--hidden');var e=a.slice(0,200),f=[];e.forEach(function(a){8<=a&&255!==a&&f.push(a.toString(2).substr(0,4))}),d.innerHTML=f.join(' '),b()}function g(){function a(){if('up'===m)i<k?(i+=l,b(),!g&&(e.classList.add(f),g=!0)):(m='down',b(),g&&(e.classList.remove(f),g=!1));else if(0<i)i-=l,b();else{var d=h(3*Math.random())+2;c.setAttribute('scale',0),setTimeout(function(){a(),m='up'},1e3*d)}}function b(){var b=i;j=i/2.5,i%2&&(b=-b),c.setAttribute('scale',b),d.setAttribute('dx',-j),d.setAttribute('dy',-j),requestAnimationFrame(a)}var c=document.getElementById('feMap'),d=document.getElementById('feOffset'),e=document.querySelector('.content'),f='content--has-filter',g=!1,i=0,j=0,k=240,l=k/3,m='up';a()}var h=Math.round;(function(){navigator.mediaDevices.getUserMedia({audio:!0,video:{width:{min:320,ideal:800},height:{min:240,ideal:600}}}).then(function(b){var d=document.querySelector('.video'),f=document.querySelector('.content');d.srcObject=b,d.addEventListener('loadedmetadata',function(){d.play(),f.classList.add('content--video-playing'),g()}),c(b),a(d,b),e(d)}).catch(function(a){console.log('Error: ',a.name+': '+a.message)})})()}();
//# sourceMappingURL=common.js.map
